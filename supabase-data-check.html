<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase ë°ì´í„° í™•ì¸</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
        .btn { padding: 10px 20px; margin: 10px 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 20px 0; border-radius: 5px; font-family: monospace; white-space: pre-wrap; max-height: 400px; overflow-y: auto; }
        .error { color: red; }
        .success { color: green; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>Supabase ë°ì´í„° í™•ì¸ ë„êµ¬</h1>
    
    <div>
        <button class="btn btn-primary" onclick="checkProfiles()">í”„ë¡œí•„ ë°ì´í„° í™•ì¸</button>
        <button class="btn btn-success" onclick="addTestProfile()">í…ŒìŠ¤íŠ¸ í”„ë¡œí•„ ì¶”ê°€</button>
        <button class="btn" onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
    </div>

    <div id="log" class="log"></div>
    <div id="data-display"></div>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // ë¡œê·¸ í•¨ìˆ˜
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            logElement.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            document.getElementById('data-display').innerHTML = '';
        }

        // Supabase ì„¤ì •
        const SUPABASE_URL = 'https://wamndgvguaybvgoudpxm.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndhbW5kZ3ZndWF5YnZnb3VkcHhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2NDEwOTYsImV4cCI6MjA2NTIxNzA5Nn0.MmHWayjKCZbA_f9p4A5cToUnNbhslpavmfoanH5mlZU';
        let supabaseClient = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            log("í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ");

            try {
                if (typeof window.supabase !== 'undefined') {
                    supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    log("âœ… Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ", 'success');
                } else {
                    log("âŒ Supabase SDK ë¡œë“œ ì‹¤íŒ¨", 'error');
                }
            } catch (error) {
                log(`ì´ˆê¸°í™” ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        });

        // í”„ë¡œí•„ ë°ì´í„° í™•ì¸
        async function checkProfiles() {
            log("=== í”„ë¡œí•„ ë°ì´í„° í™•ì¸ ì‹œì‘ ===");

            if (!supabaseClient) {
                log("âŒ Supabase í´ë¼ì´ì–¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤", 'error');
                return;
            }

            try {
                // ëª¨ë“  í”„ë¡œí•„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const { data, error } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) {
                    log(`âŒ ë°ì´í„° ì¡°íšŒ ì˜¤ë¥˜: ${error.message}`, 'error');
                    
                    if (error.code === '42P01') {
                        log("ğŸ’¡ profiles í…Œì´ë¸”ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤", 'error');
                    }
                    return;
                }

                log(`âœ… ì¡°íšŒ ì„±ê³µ: ${data ? data.length : 0}ê°œì˜ í”„ë¡œí•„ ë°œê²¬`, 'success');

                // ë°ì´í„°ë¥¼ í…Œì´ë¸”ë¡œ í‘œì‹œ
                displayData(data);

            } catch (error) {
                log(`âŒ ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // ë°ì´í„°ë¥¼ í…Œì´ë¸”ë¡œ í‘œì‹œ
        function displayData(data) {
            const displayDiv = document.getElementById('data-display');
            
            if (!data || data.length === 0) {
                displayDiv.innerHTML = '<p>ì €ì¥ëœ í”„ë¡œí•„ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            let html = '<h3>ì €ì¥ëœ í”„ë¡œí•„ ë°ì´í„°</h3><table>';
            html += '<tr><th>ID</th><th>User ID</th><th>Email</th><th>Nickname</th><th>Gender</th><th>Birthdate</th><th>Bio</th><th>Created At</th></tr>';

            data.forEach(profile => {
                html += `<tr>
                    <td>${profile.id || '-'}</td>
                    <td>${profile.user_id || '-'}</td>
                    <td>${profile.email || '-'}</td>
                    <td>${profile.nickname || '-'}</td>
                    <td>${profile.gender || '-'}</td>
                    <td>${profile.birthdate || '-'}</td>
                    <td>${profile.bio ? profile.bio.substring(0, 50) + '...' : '-'}</td>
                    <td>${profile.created_at ? new Date(profile.created_at).toLocaleString() : '-'}</td>
                </tr>`;
            });

            html += '</table>';
            displayDiv.innerHTML = html;
        }

        // í…ŒìŠ¤íŠ¸ í”„ë¡œí•„ ì¶”ê°€
        async function addTestProfile() {
            log("=== í…ŒìŠ¤íŠ¸ í”„ë¡œí•„ ì¶”ê°€ ì‹œì‘ ===");

            if (!supabaseClient) {
                log("âŒ Supabase í´ë¼ì´ì–¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤", 'error');
                return;
            }

            try {
                const testProfile = {
                    user_id: 'test_user_' + Date.now(),
                    email: 'test@example.com',
                    nickname: 'í…ŒìŠ¤íŠ¸ìœ ì €' + Math.floor(Math.random() * 1000),
                    gender: 'other',
                    birthdate: '1995-01-01',
                    bio: 'í…ŒìŠ¤íŠ¸ í”„ë¡œí•„ì…ë‹ˆë‹¤.',
                    profile_picture_url: '',
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };

                log(`ì¶”ê°€í•  ë°ì´í„°: ${JSON.stringify(testProfile, null, 2)}`);

                const { data, error } = await supabaseClient
                    .from('profiles')
                    .insert(testProfile)
                    .select();

                if (error) {
                    log(`âŒ í…ŒìŠ¤íŠ¸ í”„ë¡œí•„ ì¶”ê°€ ì‹¤íŒ¨: ${error.message}`, 'error');
                } else {
                    log(`âœ… í…ŒìŠ¤íŠ¸ í”„ë¡œí•„ ì¶”ê°€ ì„±ê³µ: ${JSON.stringify(data)}`, 'success');
                    
                    // ë°ì´í„° ë‹¤ì‹œ ì¡°íšŒ
                    await checkProfiles();
                }

            } catch (error) {
                log(`âŒ ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
